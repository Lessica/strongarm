image: python:3.7

pipelines:
  default:
    - step:
        caches:
          - pip
        script:
          - curl https://sh.rustup.rs -sSf | sh -s -- -y
          - ~/.cargo/bin/cargo install cpp_demangle --example cppfilt
          - pip install pipenv
          - export PIP_PROCESS_DEPENDENCY_LINKS=1
          - pipenv install --dev
          - pipenv run invoke deps
          - pipenv run invoke install
          - pipenv run invoke test
        script:
          - curl https://sh.rustup.rs -sSf | sh -s -- -y
          - ~/.cargo/bin/cargo install cpp_demangle --example cppfilt
          - pip install invoke pipenv pytest mypy flake8
          - python setup.py install
          - # Build the dataflow module
          - python setup.py build_ext --inplace
          - invoke test
